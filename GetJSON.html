<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ìƒí’ˆ ì½”ë“œ ì¶”ì¶œê¸° (v4.3)</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/xml/xml.min.js"></script>
    
    <style>
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Malgun Gothic', sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; background-color: #f9f9f9;
        }
        .container {
            background-color: white; padding: 30px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        h1 { text-align: center; color: #333; margin-bottom: 20px; }
        .tab-container { display: flex; margin-bottom: 15px; }
        .tab {
            flex: 1; padding: 15px; cursor: pointer; text-align: center; background-color: #e9ecef; border: 1px solid #dee2e6;
            border-bottom: none; font-weight: bold; font-size: 16px; transition: background-color 0.3s;
        }
        .tab:first-child { border-top-left-radius: 8px; }
        .tab:last-child { border-top-right-radius: 8px; }
        .tab.active { background-color: #fff; border-bottom: 1px solid #fff; color: #007bff; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .input-group { display: flex; flex-direction: column; gap: 15px; }
        .input-field-wrapper { display: flex; align-items: center; gap: 10px; }
        .input-field-wrapper label { white-space: nowrap; font-weight: bold; font-size: 14px; }
        .input-field-wrapper input {
            width: 100%; box-sizing: border-box; border: 1px solid #ccc; border-radius: 4px; font-size: 16px; padding: 15px;
        }
        .CodeMirror {
            border: 1px solid #ccc; border-radius: 4px; font-size: 14px; resize: vertical; overflow: auto !important;
        }
        .action-buttons { display: flex; gap: 10px; }
        .action-buttons button {
            flex: 1; padding: 15px; font-size: 16px; border: none; border-radius: 4px; font-weight: bold;
            cursor: pointer; transition: background-color 0.3s;
        }
        #extract-btn { background-color: #007bff; color: white; }
        #reset-btn { background-color: #6c757d; color: white; }
        #result-container { margin-top: 30px; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; word-break: break-all; }
        th { background-color: #f2f2f2; font-weight: bold; }
        #button-row { display: none; margin-top: 15px; gap: 10px; }
        #button-row button { flex: 1; padding: 15px; }
        .floating-buttons {
            position: fixed; bottom: 30px; right: 30px; display: flex; flex-direction: column; gap: 10px; z-index: 1000;
        }
        .floating-buttons button {
            width: 50px; height: 50px; border-radius: 50%; border: none; background-color: rgba(0, 0, 0, 0.6);
            color: white; font-size: 24px; cursor: pointer; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2); transition: background-color 0.3s;
        }
        .floating-buttons button:hover { background-color: rgba(0, 0, 0, 0.8); }
    </style>
</head>
<body>

    <div class="container">
        <h1>ìƒí’ˆ ì½”ë“œ ì¶”ì¶œê¸° ğŸ”‘</h1>

        <div class="tab-container">
            <div class="tab active" onclick="openTab(event, 'json-tab')">JSON ê¸°ë°˜ ìƒí’ˆ ì½”ë“œ ì¶”ì¶œ</div>
            <div class="tab" onclick="openTab(event, 'html-tab')">HTML ê¸°ë°˜ ìƒí’ˆ ì½”ë“œ ì¶”ì¶œ</div>
        </div>

        <div id="json-tab" class="tab-content active">
            <div class="input-group">
                <textarea id="json-input"></textarea>
                <div class="input-field-wrapper">
                    <label for="json-key-input">ì¶”ì¶œ ëŒ€ìƒ Key ì…ë ¥</label>
                    <input type="text" id="json-key-input" placeholder="ë”°ì˜´í‘œë¥¼ ì œì™¸í•œ Key ì´ë¦„ë§Œ ì…ë ¥í•˜ì„¸ìš”.">
                </div>
            </div>
        </div>

        <div id="html-tab" class="tab-content">
            <div class="input-group">
                <textarea id="html-input"></textarea>
                <div class="input-field-wrapper">
                    <label for="html-url-input">ì¶”ì¶œ ëŒ€ìƒ URL ì…ë ¥</label>
                    <input type="text" id="html-url-input" placeholder="ìƒí’ˆ ì½”ë“œ ì•ê¹Œì§€ì˜ ê³µí†µ URLì„ ì…ë ¥í•˜ì„¸ìš”.">
                </div>
            </div>
        </div>

        <div class="action-buttons" style="margin-top: 15px;">
            <button id="extract-btn" onclick="extractValues()">ì¶”ì¶œ</button>
            <button id="reset-btn" onclick="resetAll()">ì´ˆê¸°í™”</button>
        </div>

        <div id="result-container">
            <h3 id="result-title"><strong>ì¶”ì¶œ ê²°ê³¼</strong></h3>
            <table id="result-table">
                <thead><tr><th>ì¶”ì¶œëœ ê°’</th></tr></thead>
                <tbody></tbody>
            </table>
            <div id="button-row">
                <button id="export-btn" class="action-buttons" onclick="exportToCSV()">CSV ë‹¤ìš´ë¡œë“œ</button>
                <button id="copy-btn" class="action-buttons" style="background-color: #ff8c00;" onclick="copyToClipboard()">í´ë¦½ë³´ë“œë¡œ ë³µì‚¬</button>
            </div>
        </div>
    </div>
    
    <div class="floating-buttons">
        <button onclick="scrollToTop()">â–²</button>
        <button onclick="scrollToBottom()">â–¼</button>
    </div>

    <script>
        // ì—ë””í„° ì´ˆê¸°í™”
        const jsonEditor = CodeMirror.fromTextArea(document.getElementById("json-input"), { lineNumbers: true, mode: "application/json", theme: "default" });
        jsonEditor.setSize("100%", 500);
        const htmlEditor = CodeMirror.fromTextArea(document.getElementById("html-input"), { lineNumbers: true, mode: "xml", theme: "default" });
        htmlEditor.setSize("100%", 500);

        // íƒ­ ì „í™˜
        function openTab(evt, tabName) {
            document.querySelectorAll('.tab-content').forEach(tc => tc.style.display = "none");
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.classList.add('active');
            if (tabName === 'json-tab') jsonEditor.refresh();
            if (tabName === 'html-tab') htmlEditor.refresh();
        }

        // ì—”í„°í‚¤ ì´ë²¤íŠ¸
        document.getElementById('json-key-input').addEventListener('keyup', e => e.key === 'Enter' && extractValues());
        document.getElementById('html-url-input').addEventListener('keyup', e => e.key === 'Enter' && extractValues());
        
        // ì´ˆê¸°í™”
        function resetAll() {
            const activeTab = document.querySelector('.tab.active').getAttribute('onclick').includes('json-tab') ? 'json' : 'html';
            if (activeTab === 'json') {
                jsonEditor.setValue('');
                document.getElementById('json-key-input').value = '';
                jsonEditor.focus();
            } else {
                htmlEditor.setValue('');
                document.getElementById('html-url-input').value = '';
                htmlEditor.focus();
            }
            displayResults([]); // ê²°ê³¼ì°½ ì´ˆê¸°í™”
        }

        // ì¶”ì¶œ ì‹¤í–‰
        function extractValues() {
            const activeTab = document.querySelector('.tab.active').getAttribute('onclick').includes('json-tab') ? 'json' : 'html';
            let values = [];
            try {
                values = (activeTab === 'json') ? extractFromJsonAsText() : extractFromHtml();
                displayResults(values);
            } catch (error) {
                alert("ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: " + error.message);
            }
        }

        // â­ JSON ë¬¸ë²•ê³¼ ìƒê´€ì—†ì´ í…ìŠ¤íŠ¸ì—ì„œ Key-Valueë¥¼ ì°¾ëŠ” ë¡œì§ â­
        function extractFromJsonAsText() {
            const textContent = jsonEditor.getValue();
            const key = document.getElementById('json-key-input').value;
            if (!textContent.trim() || !key.trim()) throw new Error("JSON ì›ë³¸ê³¼ ì¶”ì¶œí•  Keyë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            
            // ì •ê·œí‘œí˜„ì‹ì— ì‚¬ìš©ë  íŠ¹ìˆ˜ë¬¸ìë¥¼ ì´ìŠ¤ì¼€ì´í”„
            const escapedKey = key.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
            // "key"\s*:\s* ë‹¤ìŒì˜ ê°’ì„ ì°¾ëŠ” ì •ê·œí‘œí˜„ì‹
            // 1. "..." í˜•íƒœì˜ ë¬¸ìì—´ ê°’, 2. ë”°ì˜´í‘œ ì—†ëŠ” ìˆ«ì/ë¶ˆë¦¬ì–¸ ê°’
            const regex = new RegExp('"' + escapedKey + '"\\s*:\\s*(?:"([^"]*)"|([\\w.-]+))', 'g');
            
            const matches = textContent.matchAll(regex);
            const values = [];
            for (const match of matches) {
                // match[1]ì€ ë”°ì˜´í‘œ ì•ˆì˜ ê°’, match[2]ëŠ” ë”°ì˜´í‘œ ì—†ëŠ” ê°’ì´ë¯€ë¡œ, ë‘˜ ì¤‘ ì¡´ì¬í•˜ëŠ” ê²ƒì„ ì¶”ê°€
                values.push(match[1] || match[2]);
            }
            return values;
        }

        // HTML í…ìŠ¤íŠ¸ì—ì„œ URL íŒ¨í„´ ì°¾ëŠ” ë¡œì§ (ê¸°ì¡´ê³¼ ë™ì¼)
        function extractFromHtml() {
            const htmlString = htmlEditor.getValue();
            const baseUrl = document.getElementById('html-url-input').value;
            if (!htmlString.trim() || !baseUrl.trim()) throw new Error("HTML ì›ë³¸ê³¼ ì¶”ì¶œ ëŒ€ìƒ URLì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            
            const escapedUrl = baseUrl.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
            const regex = new RegExp(escapedUrl + "([^/?&\"'\\s]+)", "g");
            
            return Array.from(htmlString.matchAll(regex), match => match[1]);
        }

        // ê²°ê³¼ í‘œì‹œ
        function displayResults(values) {
            const tableBody = document.querySelector("#result-table tbody");
            const buttonRow = document.getElementById('button-row');
            const resultTitle = document.getElementById('result-title');

            tableBody.innerHTML = '';
            buttonRow.style.display = 'none';
            resultTitle.innerHTML = '<strong>ì¶”ì¶œ ê²°ê³¼</strong>';

            if (values && values.length > 0) {
                const uniqueCount = new Set(values).size;
                resultTitle.innerHTML = `<strong>ì¶”ì¶œ ê²°ê³¼ <span style="color: #007bff;">(ì´ ${values.length}ê±´)</span> ì¤‘ë³µì œê±° <span style="color: #28a745;">(${uniqueCount}ê±´)</span></strong>`;
                
                values.forEach(value => {
                    const row = tableBody.insertRow();
                    const cell = row.insertCell();
                    cell.textContent = value;
                });
                buttonRow.style.display = 'flex';
            } else {
                // ì´ˆê¸°í™” ì‹œì—ëŠ” ì•Œë¦¼ì„ ë„ìš°ì§€ ì•Šë„ë¡ ì²´í¬
                if (document.getElementById('json-key-input').value || document.getElementById('html-url-input').value) {
                     alert('ì¶”ì¶œëœ ì½”ë“œê°€ ì—†ìŠµë‹ˆë‹¤. ì…ë ¥ ê°’ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                }
            }
        }

        // í´ë¦½ë³´ë“œ ë³µì‚¬
        function copyToClipboard() {
            const values = Array.from(document.querySelectorAll("#result-table tbody td")).map(td => td.textContent);
            if (values.length === 0) {
                alert('ë³µì‚¬í•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            navigator.clipboard.writeText(values.join('\n')).then(() => {
                alert(`${values.length}ê°œì˜ ê°’ì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!`);
            });
        }

        // CSV ë‹¤ìš´ë¡œë“œ
        function exportToCSV() {
            const table = document.getElementById("result-table");
            let csv = [`"${table.querySelector("thead th").textContent}"`];
            table.querySelectorAll("tbody tr").forEach(row => {
                csv.push(`"${row.querySelector("td").textContent.replace(/"/g, '""')}"`);
            });

            const link = document.createElement("a");
            link.setAttribute("href", encodeURI("data:text/csv;charset=utf-8," + csv.join("\n")));
            link.setAttribute("download", "extracted_data.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // í”Œë¡œíŒ… ë²„íŠ¼ ìŠ¤í¬ë¡¤
        function scrollToTop() { window.scrollTo(0, 0); }
        function scrollToBottom() { window.scrollTo(0, document.body.scrollHeight); }
    </script>

</body>
</html>